<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' file: blob:;">
  <title>ShaderShow</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/toolbar.css">
  <link rel="stylesheet" href="css/params.css">
  <link rel="stylesheet" href="css/grid.css">
  <link rel="stylesheet" href="css/dialogs.css">
</head>
<body>
  <div id="app">
    <!-- Toolbar -->
    <div id="toolbar">
      <div class="toolbar-group">
        <button id="btn-play" title="Play/Pause (Space)">
          <span class="icon">&#9658;</span>
        </button>
        <button id="btn-reset" title="Reset Time (Ctrl+R)">
          <span class="icon">&#8634;</span>
        </button>
        <button id="btn-preview" title="Toggle Preview" class="active">
          <span class="icon">&#128065;</span>
        </button>
        <button id="btn-grid" title="Toggle Shader Grid">
          <span class="icon">&#9638;</span>
        </button>
        <button id="btn-editor" title="Toggle Editor" class="active">
          <span class="icon">&lt;/&gt;</span>
        </button>
        <button id="btn-save-shader" title="Save Shader to Active Slot (Ctrl+S)" disabled>
          <span class="icon">&#128190;</span>
        </button>
        <button id="btn-params" title="Toggle Parameters" class="active">
          <span class="icon">P</span>
        </button>
        <div class="toolbar-separator"></div>
        <button id="btn-ndi" title="Toggle NDI Output">
          <span class="icon">NDI</span>
        </button>
        <button id="btn-fullscreen" title="Fullscreen Preview (Cmd+F)">
          <span class="icon">&#9974;</span>
        </button>
        <button id="btn-blackout" title="Blackout Fullscreen (B)">
          <span class="icon">&#9679;</span>
        </button>
        <div class="toolbar-separator"></div>
        <button id="btn-settings" title="Settings">
          <span class="icon">&#9881;</span>
        </button>
      </div>

      <div class="toolbar-group">
        <label for="resolution-select">Resolution:</label>
        <select id="resolution-select">
          <option value="640x360">360p (640x360)</option>
          <option value="854x480">480p (854x480)</option>
          <option value="1280x720" selected>720p (1280x720)</option>
          <option value="1536x864">1536x864</option>
          <option value="1920x1080">1080p (1920x1080)</option>
          <option value="2560x1440">1440p (2560x1440)</option>
          <option value="3072x1824">3072x1824</option>
          <option value="3840x2160">4K (3840x2160)</option>
          <option value="custom">Custom</option>
        </select>
        <input type="number" id="custom-width" placeholder="W" min="1" max="4096" value="1280" class="hidden">
        <span id="custom-x" class="hidden">x</span>
        <input type="number" id="custom-height" placeholder="H" min="1" max="4096" value="720" class="hidden">
      </div>

      <div class="toolbar-group fps-display">
        <span id="fullscreen-fps" title="Fullscreen FPS">-- fps</span>
      </div>

      <div class="toolbar-group channels">
        <span class="channel-label">Channels:</span>
        <div class="channel-slot" id="channel-0" title="iChannel0 - Click File > Load Texture">0</div>
        <div class="channel-slot" id="channel-1" title="iChannel1 - Click File > Load Texture">1</div>
        <div class="channel-slot" id="channel-2" title="iChannel2 - Click File > Load Texture">2</div>
        <div class="channel-slot" id="channel-3" title="iChannel3 - Click File > Load Texture">3</div>
      </div>

      <div class="toolbar-group stats">
        <span id="fps-display">FPS: --</span>
        <span id="time-display">Time: 0.00s</span>
        <span id="frame-display">Frame: 0</span>
      </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
      <!-- Editor Panel -->
      <div id="editor-panel">
        <div id="editor"></div>
      </div>

      <!-- Resizer -->
      <div id="resizer"></div>

      <!-- Right Panel Container -->
      <div id="right-panel">
        <!-- Shader Grid Panel -->
        <div id="grid-panel" class="hidden">
          <div class="shader-grid">
            <div class="grid-slot" data-slot="0"><canvas></canvas><span class="slot-number">1</span></div>
            <div class="grid-slot" data-slot="1"><canvas></canvas><span class="slot-number">2</span></div>
            <div class="grid-slot" data-slot="2"><canvas></canvas><span class="slot-number">3</span></div>
            <div class="grid-slot" data-slot="3"><canvas></canvas><span class="slot-number">4</span></div>
            <div class="grid-slot" data-slot="4"><canvas></canvas><span class="slot-number">5</span></div>
            <div class="grid-slot" data-slot="5"><canvas></canvas><span class="slot-number">6</span></div>
            <div class="grid-slot" data-slot="6"><canvas></canvas><span class="slot-number">7</span></div>
            <div class="grid-slot" data-slot="7"><canvas></canvas><span class="slot-number">8</span></div>
            <div class="grid-slot" data-slot="8"><canvas></canvas><span class="slot-number">9</span></div>
            <div class="grid-slot" data-slot="9"><canvas></canvas><span class="slot-number">10</span></div>
            <div class="grid-slot" data-slot="10"><canvas></canvas><span class="slot-number">11</span></div>
            <div class="grid-slot" data-slot="11"><canvas></canvas><span class="slot-number">12</span></div>
            <div class="grid-slot" data-slot="12"><canvas></canvas><span class="slot-number">13</span></div>
            <div class="grid-slot" data-slot="13"><canvas></canvas><span class="slot-number">14</span></div>
            <div class="grid-slot" data-slot="14"><canvas></canvas><span class="slot-number">15</span></div>
            <div class="grid-slot" data-slot="15"><canvas></canvas><span class="slot-number">16</span></div>
          </div>
          <div class="grid-presets-section">
            <div class="grid-presets-title">Shader Presets</div>
            <div class="presets-row" id="local-presets-row">
              <span class="no-shader-hint" id="no-shader-hint">Select a shader</span>
              <button id="btn-add-local-preset" class="preset-btn add-preset hidden" title="Save preset for current shader">+</button>
            </div>
          </div>
        </div>

        <!-- Preview Panel -->
        <div id="preview-panel">
          <div id="preview-canvas-container">
            <canvas id="shader-canvas"></canvas>
          </div>
        </div>

        <!-- Parameters Side Panel (independent of preview) -->
        <div id="params-panel">
            <div class="params-section">
              <div class="params-section-title">Controls <button id="btn-reset-params" class="reset-params-btn" title="Reset all parameters to defaults">Reset</button></div>
              <div class="param-row">
                <label>Speed</label>
                <input type="range" id="param-speed" min="0" max="5" step="0.01" value="1">
                <span class="param-value" id="param-speed-value">1.00</span>
              </div>
              <div class="param-row">
                <label id="label-p0" class="param-label editable" title="Double-click to rename">P0</label>
                <input type="range" id="param-p0" min="0" max="1" step="0.01" value="0.5">
                <span class="param-value" id="param-p0-value">0.50</span>
                <select class="mouse-assign" id="mouse-p0" title="Assign to mouse">
                  <option value="">-</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                </select>
              </div>
              <div class="param-row">
                <label id="label-p1" class="param-label editable" title="Double-click to rename">P1</label>
                <input type="range" id="param-p1" min="0" max="1" step="0.01" value="0.5">
                <span class="param-value" id="param-p1-value">0.50</span>
                <select class="mouse-assign" id="mouse-p1" title="Assign to mouse">
                  <option value="">-</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                </select>
              </div>
              <div class="param-row">
                <label id="label-p2" class="param-label editable" title="Double-click to rename">P2</label>
                <input type="range" id="param-p2" min="0" max="1" step="0.01" value="0.5">
                <span class="param-value" id="param-p2-value">0.50</span>
                <select class="mouse-assign" id="mouse-p2" title="Assign to mouse">
                  <option value="">-</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                </select>
              </div>
              <div class="param-row">
                <label id="label-p3" class="param-label editable" title="Double-click to rename">P3</label>
                <input type="range" id="param-p3" min="0" max="1" step="0.01" value="0.5">
                <span class="param-value" id="param-p3-value">0.50</span>
                <select class="mouse-assign" id="mouse-p3" title="Assign to mouse">
                  <option value="">-</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                </select>
              </div>
              <div class="param-row">
                <label id="label-p4" class="param-label editable" title="Double-click to rename">P4</label>
                <input type="range" id="param-p4" min="0" max="1" step="0.01" value="0.5">
                <span class="param-value" id="param-p4-value">0.50</span>
                <select class="mouse-assign" id="mouse-p4" title="Assign to mouse">
                  <option value="">-</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                </select>
              </div>
              <div class="section-reset-row">
                <span>P0-P4:</span>
                <button id="btn-params-zero" class="section-reset-btn" title="Set all P0-P4 to minimum">All 0</button>
                <button id="btn-params-full" class="section-reset-btn" title="Set all P0-P4 to maximum">All 1</button>
              </div>
            </div>
            <div class="params-section">
              <div class="params-section-title">Colors
                <span class="section-reset-btns">
                  <button id="btn-colors-zero" class="section-reset-btn" title="Set all colors to 0">All 0</button>
                  <button id="btn-colors-full" class="section-reset-btn" title="Set all colors to 1">All 1</button>
                </span>
              </div>
              <div class="color-row" data-color="0"><span class="color-label editable" id="label-c0" title="Double-click to rename">C0</span><label class="color-red">R</label><input type="range" id="param-r0" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g0" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b0" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="1"><span class="color-label editable" id="label-c1" title="Double-click to rename">C1</span><label class="color-red">R</label><input type="range" id="param-r1" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g1" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b1" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="2"><span class="color-label editable" id="label-c2" title="Double-click to rename">C2</span><label class="color-red">R</label><input type="range" id="param-r2" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g2" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b2" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="3"><span class="color-label editable" id="label-c3" title="Double-click to rename">C3</span><label class="color-red">R</label><input type="range" id="param-r3" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g3" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b3" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="4"><span class="color-label editable" id="label-c4" title="Double-click to rename">C4</span><label class="color-red">R</label><input type="range" id="param-r4" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g4" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b4" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="5"><span class="color-label editable" id="label-c5" title="Double-click to rename">C5</span><label class="color-red">R</label><input type="range" id="param-r5" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g5" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b5" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="6"><span class="color-label editable" id="label-c6" title="Double-click to rename">C6</span><label class="color-red">R</label><input type="range" id="param-r6" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g6" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b6" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="7"><span class="color-label editable" id="label-c7" title="Double-click to rename">C7</span><label class="color-red">R</label><input type="range" id="param-r7" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g7" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b7" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="8"><span class="color-label editable" id="label-c8" title="Double-click to rename">C8</span><label class="color-red">R</label><input type="range" id="param-r8" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g8" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b8" min="0" max="1" step="0.01" value="1"></div>
              <div class="color-row" data-color="9"><span class="color-label editable" id="label-c9" title="Double-click to rename">C9</span><label class="color-red">R</label><input type="range" id="param-r9" min="0" max="1" step="0.01" value="1"><label class="color-green">G</label><input type="range" id="param-g9" min="0" max="1" step="0.01" value="1"><label class="color-blue">B</label><input type="range" id="param-b9" min="0" max="1" step="0.01" value="1"></div>
            </div>
            <div class="params-section presets-section">
              <div class="params-section-title">Global Presets</div>
              <div class="presets-row" id="global-presets-row">
                <button id="btn-add-global-preset" class="preset-btn add-preset" title="Save as global preset">+</button>
              </div>
            </div>
          </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
      <span id="status-message">Ready</span>
      <span id="cursor-position">Ln 1, Col 1</span>
    </div>
  </div>

  <!-- Ace Editor -->
  <script src="node_modules/ace-builds/src-min-noconflict/ace.js"></script>
  <script src="node_modules/ace-builds/src-min-noconflict/mode-glsl.js"></script>
  <script src="node_modules/ace-builds/src-min-noconflict/theme-monokai.js"></script>

  <script src="shader-renderer.js"></script>
  <script type="module" src="js/renderer.js"></script>
</body>
</html>
